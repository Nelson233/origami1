/*! For license information please see echarts-extension-amap.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("echarts")):"function"==typeof define&&define.amd?define(["exports","echarts"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).echarts=e.echarts||{},e.echarts.amap={}),e.echarts)}(this,(function(e,t){"use strict";function n(e,t){this._amap=e,this.dimensions=["lng","lat"],this._mapOffset=[0,0],this._api=t}var o=n.prototype,a=["echartsLayerZIndex","renderOnMoving","layers"];function i(e,n){return n=n||[0,0],t.util.map([0,1],(function(t){var o=n[t],a=e[t]/2,i=[],r=[];return i[t]=o-a,r[t]=o+a,i[1-t]=r[1-t]=n[1-t],Math.abs(this.dataToPoint(i)[t]-this.dataToPoint(r)[t])}),this)}o.dimensions=["lng","lat"],o.setZoom=function(e){this._zoom=e},o.setCenter=function(e){var t=new AMap.LngLat(e[0],e[1]);this._center=this._amap.lngLatToContainer(t)},o.setMapOffset=function(e){this._mapOffset=e},o.setAMap=function(e){this._amap=e},o.getAMap=function(){return this._amap},o.dataToPoint=function(e){var t=new AMap.LngLat(e[0],e[1]),n=this._amap.lngLatToContainer(t),o=this._mapOffset;return[n.x-o[0],n.y-o[1]]},o.pointToData=function(e){var t=this._mapOffset,n=this._amap.containerToLngLat(new AMap.Pixel(e[0]+t[0],e[1]+t[1]));return[n.lng,n.lat]},o.getViewRect=function(){var e=this._api;return new t.graphic.BoundingRect(0,0,e.getWidth(),e.getHeight())},o.getRoamTransform=function(){return t.matrix.create()},o.prepareCustoms=function(e){var n=this.getViewRect();return{coordSys:{type:"amap",x:n.x,y:n.y,width:n.width,height:n.height},api:{coord:t.util.bind(this.dataToPoint,this),size:t.util.bind(i,this)}}},n.dimensions=o.dimensions,n.create=function(e,o){var i,r=o.getDom();e.eachComponent("amap",(function(e){var s=o.getZr().painter,p=s.getViewportRoot();if("undefined"==typeof AMap)throw new Error("AMap api is not loaded");if(i)throw new Error("Only one amap component can exist");var f,c,u,m,l=e.getAMap();if(!l){var d=r.querySelector(".ec-extension-amap");d&&(p.style.left="0px",p.style.top="0px",r.removeChild(d)),(d=document.createElement("div")).className="ec-extension-amap",d.style.cssText="position:absolute;width:100%;height:100%",r.appendChild(d);var h=t.util.clone(e.get()),y=h.echartsLayerZIndex;t.util.each(a,(function(e){delete h[e]})),l=new AMap.Map(d,h),e.setAMap(l);var g=new AMap.CustomLayer(p,{zIndex:y});e.setEChartsLayer(g),l.add(g),f=".ec-amap-not-zoom",c="left:0!important;top:0!important",u=(u=1/0)||0,(m=AMap.version>=2?document.getElementById("AMap_Dynamic_style").sheet:document.getElementsByClassName("AMap.style")[0].sheet).insertRule?m.insertRule(f+"{"+c+"}",u):m.addRule&&m.addRule(f,c,u),s.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}var v=e.get("center"),_=e.get("zoom");if(v&&_){var M=l.getCenter(),w=l.getZoom();if(e.centerOrZoomChanged([M.lng,M.lat],w)){var O=new AMap.LngLat(v[0],v[1]);l.setZoomAndCenter(_,O)}}var b=e.__mapStyle,T=e.get("mapStyle");if(b!==T&&(l.setMapStyle(T),e.__mapStyle=T),l.setLang){var A=e.__mapLang,x=e.get("lang");A!==x&&(l.setLang(x),e.__mapLang=x)}(i=new n(l,o)).setMapOffset(e.__mapOffset||[0,0]),i.setZoom(_),i.setCenter(v),e.coordinateSystem=i})),e.eachSeries((function(e){"amap"===e.get("coordinateSystem")&&(e.coordinateSystem=i)}))},t.extendComponentModel({type:"amap",setAMap:function(e){this.__amap=e},getAMap:function(){return this.__amap},setEChartsLayer:function(e){this.__echartsLayer=e},getEChartsLayer:function(){return this.__echartsLayer},setCenterAndZoom:function(e,t){this.option.center=e,this.option.zoom=t},centerOrZoomChanged:function(e,t){var n,o,a=this.option;return n=e,o=a.center,!(n&&o&&n[0]===o[0]&&n[1]===o[1]&&t===a.zoom)},defaultOption:{center:[116.397428,39.90923],zoom:5,isHotspot:!1,resizeEnable:!0,echartsLayerZIndex:2e3,renderOnMoving:!0}});var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},s=/^\s+|\s+$/g,p=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt,m="object"==typeof r&&r&&r.Object===Object&&r,l="object"==typeof self&&self&&self.Object===Object&&self,d=m||l||Function("return this")(),h=Object.prototype.toString,y=Math.max,g=Math.min,v=function(){return d.Date.now()};function _(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function M(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==h.call(e)}(e))return NaN;if(_(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=_(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var n=f.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):p.test(e)?NaN:+e}var w=function(e,t,n){var o,a,i,r,s,p,f=0,c=!1,u=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function l(t){var n=o,i=a;return o=a=void 0,f=t,r=e.apply(i,n)}function d(e){var n=e-p;return void 0===p||n>=t||n<0||u&&e-f>=i}function h(){var e=v();if(d(e))return w(e);s=setTimeout(h,function(e){var n=t-(e-p);return u?g(n,i-(e-f)):n}(e))}function w(e){return s=void 0,m&&o?l(e):(o=a=void 0,r)}function O(){var e=v(),n=d(e);if(o=arguments,a=this,p=e,n){if(void 0===s)return function(e){return f=e,s=setTimeout(h,t),c?l(e):r}(p);if(u)return s=setTimeout(h,t),l(p)}return void 0===s&&(s=setTimeout(h,t)),r}return t=M(t)||0,_(n)&&(c=!!n.leading,i=(u="maxWait"in n)?y(M(n.maxWait)||0,t):i,m="trailing"in n?!!n.trailing:m),O.cancel=function(){void 0!==s&&clearTimeout(s),f=0,o=p=a=s=void 0},O.flush=function(){return void 0===s?r:w(v())},O};t.extendComponentView({type:"amap",render:function(e,n,o){var a=!0,i=e.getAMap(),r=o.getZr().painter.getViewportRoot(),s=i.getContainer(),p=r.parentNode,f=e.coordinateSystem,c=e.getEChartsLayer(),u=e.get("renderOnMoving"),m=e.get("resizeEnable"),l=AMap.version>=2,d="3D"===i.getViewMode_(),h=!l&&!d;p&&p.classList.add("ec-amap-not-zoom");var y,g=function(t){if(a)return;var n=[-parseInt(s.style.left,10)||0,-parseInt(s.style.top,10)||0];const i=r.style,p=n[0]+"px",c=n[1]+"px";i.left!==p&&(i.left=p),i.top!==c&&(i.top=c),f.setMapOffset(n),e.__mapOffset=n,o.dispatchAction({type:"amapRoam",animation:{duration:0}})},v=function(e){a||!l&&d||c.setOpacity(h?0:.01)},_=function(e){a||(h||c.setOpacity(1),o.dispatchAction({type:"amapRoam",animation:{duration:0}}),h&&(clearTimeout(this._layerOpacityTimeout),this._layerOpacityTimeout=setTimeout((function(){c.setOpacity(1)}),0)))};i.off("mapmove",this._oldMoveHandler),i.off("moveend",this._oldMoveHandler),i.off("viewchange",this._oldMoveHandler),i.off("camerachange",this._oldMoveHandler),i.off("zoomstart",this._oldZoomStartHandler),i.off("zoomend",this._oldZoomEndHandler),i.off("resize",this._oldResizeHandler),i.on(u?l?"viewchange":d?"camerachange":"mapmove":"moveend",h?g=w(g,0):g),i.on("zoomstart",v),i.on("zoomend",_=t.util.bind(_,this)),m&&(y=function(e){clearTimeout(this._resizeDelay),this._resizeDelay=setTimeout((function(){t.getInstanceByDom(o.getDom()).resize()}),100)},y=t.util.bind(y,this),i.on("resize",y)),this._oldMoveHandler=g,this._oldZoomStartHandler=v,this._oldZoomEndHandler=_,m&&(this._oldResizeHandler=y),a=!1},dispose:function(e,t){clearTimeout(this._layerOpacityTimeout),clearTimeout(this._resizeDelay);var n=e.getComponent("amap");n&&(n.getAMap().destroy(),n.setAMap(null),n.setEChartsLayer(null),n.coordinateSystem&&(n.coordinateSystem.setAMap(null),n.coordinateSystem=null))}}),t.registerCoordinateSystem("amap",n),t.registerAction({type:"amapRoam",event:"amapRoam",update:"updateLayout"},(function(e,t){t.eachComponent("amap",(function(e){var t=e.getAMap(),n=t.getCenter();e.setCenterAndZoom([n.lng,n.lat],t.getZoom())}))})),e.name="echarts-extension-amap",e.version="1.8.0",Object.defineProperty(e,"__esModule",{value:!0})}));